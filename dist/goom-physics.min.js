define("src/vector3d",[],function(){var a=function(){function a(a,b,c){this.x=a!==null&&a!==undefined?a:0,this.y=b!==null&&b!==undefined?b:0,this.z=c!==null&&c!==undefined?c:0}return a.prototype.set=function(a,b,c){return this.x=a,this.y=b,this.z=c,this},a.prototype.clone=function(b){if(b===null||b===undefined)b=new a;return b.x=this.x,b.y=this.y,b.z=this.z,b},a.prototype.add=function(a,b){if(b===null||b===undefined)b=this;return b.x=this.x+a.x,b.y=this.y+a.y,b.z=this.z+a.z,b},a.prototype.scale=function(a,b){if(b===null||b===undefined)b=this;return b.x=this.x*a,b.y=this.y*a,b.z=this.z*a,b},a.prototype.substract=function(a,b){if(b===null||b===undefined)b=this;return b.x=this.x-a.x,b.y=this.y-a.y,b.z=this.z-a.z,b},a.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},a.prototype.magnitude=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},a.prototype.squaredMagnitude=function(){return this.x*this.x+this.y*this.y+this.z*this.z},a.prototype.crossProduct=function(a,b){var c,d;if(b===null||b===undefined)b=this;return c=this.y*a.z-this.z*a.y,d=this.z*a.x-this.x*a.z,b.z=this.x*a.y-this.y*a.x,b.x=c,b.y=d,b},a.prototype.dotProduct=function(a){return this.x*a.x+this.y*a.y+this.z*a.z},a.prototype.componentProduct=function(a,b){if(b===null||b===undefined)b=this;return b.x=this.x*a.x,b.y=this.y*a.y,b.z=this.z*a.z,b},a.prototype.normalize=function(a){var b,c;if(a===null||a===undefined)a=this;return c=this.magnitude(),b=1/c,c===0?(a.x=0,a.y=0,a.z=0,a):c===1?(a.x=this.x,a.y=this.y,a.z=this.z,a):(a.x=this.x*b,a.y=this.y*b,a.z=this.z*b,a)},a.prototype.zero=function(){return this.x=this.y=this.z=0,this},a.RIGHT=new a(1,0,0),a.UP=new a(0,1,0),a.LEFT=new a(-1,0,0),a.DOWN=new a(0,-1,0),a.Z_AXIS=new a(0,0,1),a}();return a}),define("src/quaternion",["./vector3d"],function(a){var b=function(){function a(a,b,c,d){this.r=a!==null&&a!==undefined?a:1,this.i=b!==null&&b!==undefined?b:0,this.j=c!==null&&c!==undefined?c:0,this.k=d!==null&&d!==undefined?d:0}return a.prototype.makeIdentity=function(){return this.r=1,this.i=this.j=this.k=0,this},a.prototype.set=function(a,b,c,d){return this.r=a,this.i=b,this.j=c,this.k=d,this},a.prototype.normalize=function(){var a=this.r*this.r+this.i*this.i+this.j*this.j+this.k*this.k;return a===0?(this.r=1,this):(a=1/Math.sqrt(a),this.r*=a,this.i*=a,this.j*=a,this.k*=a,this)},a.prototype.multiply=function(a,b){if(b===null||b===undefined)b=this;var c=this.r*a.r-this.i*a.i-this.j*a.j-this.k*a.k,d=this.r*a.i+this.i*a.r+this.j*a.k-this.k*a.j,e=this.r*a.j+this.j*a.r+this.k*a.i-this.i*a.k;return b.k=this.r*a.k+this.k*a.r+this.i*a.j-this.j*a.i,b.r=c,b.i=d,b.j=e,b},a.prototype.rotateByVector=function(a,b){if(b===null||b===undefined)b=this;var c=-this.i*a.x-this.j*a.y-this.k*a.z,d=this.r*a.x+this.j*a.z-this.k*a.y,e=this.r*a.y+this.k*a.x-this.i*a.z;return b.k=this.r*a.z+this.i*a.y-this.j*a.x,b.r=c,b.i=d,b.j=e,b},a.prototype.addVector=function(a,b){if(b===null||b===undefined)b=this;var c=-a.x*this.i-a.y*this.j-a.z*this.k,d=a.x*this.r+a.y*this.k-a.z*this.j,e=a.y*this.r+a.z*this.i-a.x*this.k,f=a.z*this.r+a.x*this.j-a.y*this.i;return b.r=this.r+c*.5,b.i=this.i+d*.5,b.j=this.j+e*.5,b.k=this.k+f*.5,b},a}();return b}),define("src/matrix3d",["./vector3d"],function(a){var b=function(){function a(){typeof Float32Array!="undefined"&&Float32Array!==null?this.data=new Float32Array(9):this.data=new Array(9),this.makeIdentity()}return a.prototype.clone=function(b){if(b===null||b===undefined)b=new a;for(var c=0;c<=8;c++)b.data[c]=this.data[c];return b},a.prototype.set=function(a){for(var b=0;b<=8;b++)this.data[b]=a[b];return this},a.prototype.setDiagonal=function(a,b,c){return this.data[0]=a,this.data[4]=b,this.data[8]=c,this},a.prototype.makeFromVectors=function(a,b,c){return this.data[0]=a.x,this.data[1]=a.y,this.data[2]=a.z,this.data[3]=b.x,this.data[4]=b.y,this.data[5]=b.z,this.data[6]=c.x,this.data[7]=c.y,this.data[8]=c.z,this},a.prototype.makeSkewSymmetric=function(a){return this.data[0]=this.data[4]=this.data[8]=0,this.data[1]=a.z,this.data[2]=-a.y,this.data[3]=-a.z,this.data[5]=a.x,this.data[6]=a.y,this.data[7]=-a.x,this},a.prototype.makeIdentity=function(){for(var a=0;a<=8;a++)this.data[a]=0;return this.data[0]=this.data[4]=this.data[8]=1,this},a.prototype.transpose=function(a){if(a===null||a===undefined)a=this;var b=this.data[1];return a.data[1]=this.data[3],a.data[3]=b,b=this.data[2],a.data[2]=this.data[6],a.data[6]=b,b=this.data[5],a.data[5]=this.data[7],a.data[7]=b,a.data[0]=this.data[0],a.data[4]=this.data[4],a.data[8]=this.data[8],a},a.prototype.inverse=function(a){if(a===null||a===undefined)a=this;var b=this.data[0]*this.data[4],c=this.data[0]*this.data[7],d=this.data[3]*this.data[1],e=this.data[6]*this.data[1],f=this.data[3]*this.data[2],g=this.data[6]*this.data[2],h=b*this.data[8]-c*this.data[5]-d*this.data[8]+e*this.data[5]+f*this.data[7]-g*this.data[4];if(h===0)return a.data[0]=this.data[0],a.data[1]=this.data[1],a.data[2]=this.data[2],a.data[3]=this.data[3],a.data[4]=this.data[4],a.data[5]=this.data[5],a.data[6]=this.data[6],a.data[7]=this.data[7],a.data[8]=this.data[8],a;var i=1/h,j=(this.data[4]*this.data[8]-this.data[7]*this.data[5])*i,k=-(this.data[1]*this.data[8]-this.data[7]*this.data[2])*i,l=(this.data[1]*this.data[5]-this.data[4]*this.data[2])*i,m=-(this.data[3]*this.data[8]-this.data[6]*this.data[5])*i,n=(this.data[0]*this.data[8]-g)*i,o=-(this.data[0]*this.data[5]-f)*i,p=(this.data[3]*this.data[7]-this.data[6]*this.data[4])*i,q=-(c-e)*i,r=(b-d)*i;return a.data[0]=j,a.data[1]=k,a.data[2]=l,a.data[3]=m,a.data[4]=n,a.data[5]=o,a.data[6]=p,a.data[7]=q,a.data[8]=r,a},a.prototype.add=function(a,b){if(b===null||b===undefined)b=this;for(var c=0;c<=8;c++)b.data[c]=this.data[c]+a.data[c];return b},a.prototype.multiply=function(a,b){if(b===null||b===undefined)b=this;var c=this.data[0]*a.data[0]+this.data[3]*a.data[1]+this.data[6]*a.data[2],d=this.data[1]*a.data[0]+this.data[4]*a.data[1]+this.data[7]*a.data[2],e=this.data[2]*a.data[0]+this.data[5]*a.data[1]+this.data[8]*a.data[2],f=this.data[0]*a.data[3]+this.data[3]*a.data[4]+this.data[6]*a.data[5],g=this.data[1]*a.data[3]+this.data[4]*a.data[4]+this.data[7]*a.data[5],h=this.data[2]*a.data[3]+this.data[5]*a.data[4]+this.data[8]*a.data[5],i=this.data[0]*a.data[6]+this.data[3]*a.data[7]+this.data[6]*a.data[8],j=this.data[1]*a.data[6]+this.data[4]*a.data[7]+this.data[7]*a.data[8],k=this.data[2]*a.data[6]+this.data[5]*a.data[7]+this.data[8]*a.data[8];return b.data[0]=c,b.data[1]=d,b.data[2]=e,b.data[3]=f,b.data[4]=g,b.data[5]=h,b.data[6]=i,b.data[7]=j,b.data[8]=k,b},a.prototype.scale=function(a,b){if(b===null||b===undefined)b=this;for(var c=0;c<=8;c++)b.data[c]=a*this.data[c];return b},a.prototype.transformVector=function(a,b){if(b===null||b===undefined)b=a;var c=a.x*this.data[0]+a.y*this.data[3]+a.z*this.data[6],d=a.x*this.data[1]+a.y*this.data[4]+a.z*this.data[7];return b.z=a.x*this.data[2]+a.y*this.data[5]+a.z*this.data[8],b.x=c,b.y=d,b},a.prototype.transformTransposeVector=function(a,b){if(b===null||b===undefined)b=a;var c=a.x*this.data[0]+a.y*this.data[1]+a.z*this.data[2],d=a.x*this.data[3]+a.y*this.data[4]+a.z*this.data[5];return b.z=a.x*this.data[6]+a.y*this.data[7]+a.z*this.data[8],b.x=c,b.y=d,b},a}();return b}),define("src/matrix4d",["./vector3d","./quaternion","./matrix3d"],function(a,b,c){var d=function(){function b(){typeof Float32Array!==undefined&&Float32Array!==null?this.data=new Float32Array(16):this.data=new Array(16),this.makeIdentity()}return b.prototype.clone=function(a){if(a===null||a===undefined)a=new b;for(var c=0;c<=15;c++)a.data[c]=this.data[c];return a},b.prototype.set=function(a){for(var b=0;b<=15;b++)this.data[b]=a[b];return this},b.prototype.makeIdentity=function(){for(var a=0;a<=15;a++)this.data[a]=0;return this.data[0]=this.data[5]=1,this.data[10]=this.data[15]=1,this},b.prototype.makeTranslation=function(a,b,c){return this.makeIdentity(),this.data[12]=a,this.data[13]=b,this.data[14]=c,this},b.prototype.translate=function(a,b,c,d){if(d===null||d===undefined)d=this;for(var e=0;e<=11;e++)d.data[e]=this.data[e];return d.data[12]=this.data[0]*a+this.data[4]*b+this.data[8]*c+this.data[12],d.data[13]=this.data[1]*a+this.data[5]*b+this.data[9]*c+this.data[13],d.data[14]=this.data[2]*a+this.data[6]*b+this.data[10]*c+this.data[14],d.data[15]=this.data[3]*a+this.data[7]*b+this.data[11]*c+this.data[15],d},b.prototype.makeScale=function(a,b,c){return this.makeIdentity(),this.data[0]=a,this.data[5]=b,this.data[10]=c,this},b.prototype.scale=function(a,b,c,d){if(d===null||d===undefined)d=this;return d.data[0]=this.data[0]*a,d.data[1]=this.data[1]*a,d.data[2]=this.data[2]*a,d.data[3]=this.data[3]*a,d.data[4]=this.data[4]*b,d.data[5]=this.data[5]*b,d.data[6]=this.data[6]*b,d.data[7]=this.data[7]*b,d.data[8]=this.data[8]*c,d.data[9]=this.data[9]*c,d.data[10]=this.data[10]*c,d.data[11]=this.data[11]*c,d.data[12]=this.data[12],d.data[13]=this.data[13],d.data[14]=this.data[14],d.data[15]=this.data[15],d},b.prototype.makeRotation=function(a,b){this.makeIdentity();var c=Math.cos(b),d=Math.sin(b),e=1-c;return a.magnitude()>0&&(a.normalize(),this.data[0]=e*a.x*a.x+c,this.data[1]=e*a.x*a.y+a.z*d,this.data[2]=e*a.z*a.x-a.y*d,this.data[4]=e*a.x*a.y-a.z*d,this.data[5]=e*a.y*a.y+c,this.data[6]=e*a.z*a.y-a.x*d,this.data[8]=e*a.z*a.x+a.y*d,this.data[9]=e*a.y*a.z+a.x*d,this.data[10]=e*a.z*a.z+c),this},b.prototype.transpose=function(a){if(a===null||a===undefined)a=this;var b=this.data[1];return a.data[1]=this.data[4],a.data[4]=b,b=this.data[2],a.data[2]=this.data[8],a.data[8]=b,b=this.data[3],a.data[3]=this.data[12],a.data[12]=b,b=this.data[6],a.data[6]=this.data[9],a.data[9]=b,b=this.data[7],a.data[7]=this.data[13],a.data[13]=b,b=this.data[11],a.data[11]=this.data[14],a.data[14]=b,a},b.prototype.makeFrustum=function(a,b,c,d,e,f){this.makeIdentity();var g=b-a,h=d-c,i=f-e,j=2*e;return this.data[0]=j/g,this.data[5]=j/h,this.data[8]=(b+a)/g,this.data[9]=(d+c)/h,this.data[10]=-(f+e)/i,this.data[11]=-1,this.data[14]=-j*f/i,this.data[15]=0,this},b.prototype.makePerspective=function(a,b,c,d){var e=b*Math.tan(a/(180*Math.PI)/2);return this.makeFrustum(-e,e,-e/d,e/d,b,c)},b.prototype.makeOrthographic=function(a,b,c,d,e,f){var g=b-a,h=d-c,i=f-e;return this.data[0]=2/g,this.data[1]=0,this.data[2]=0,this.data[3]=0,this.data[4]=0,this.data[5]=2/h,this.data[6]=0,this.data[7]=0,this.data[8]=0,this.data[9]=0,this.data[10]=-2/i,this.data[11]=0,this.data[12]=-(a+b)/g,this.data[13]=-(d+c)/h,this.data[14]=-(f+e)/i,this.data[15]=1,this},b.prototype.makeFromQuaternion=function(a){return this.data[0]=1-(2*a.j*a.j+2*a.k*a.k),this.data[1]=2*a.i*a.j-2*a.k*a.r,this.data[2]=2*a.i*a.k+2*a.j*a.r,this.data[3]=0,this.data[4]=2*a.i*a.j+2*a.k*a.r,this.data[5]=1-(2*a.i*a.i+2*a.k*a.k),this.data[6]=2*a.j*a.k-2*a.i*a.r,this.data[7]=0,this.data[8]=2*a.i*a.k-2*a.j*a.r,this.data[9]=2*a.j*a.k+2*a.i*a.r,this.data[10]=1-(2*a.i*a.i+2*a.j*a.j),this.data[11]=0,this.data[12]=this.data[13]=this.data[14]=0,this.data[15]=1,this},b.prototype.makeFromPositionAndOrientation=function(a,b){return this.data[0]=1-(2*b.j*b.j+2*b.k*b.k),this.data[1]=2*b.i*b.j-2*b.k*b.r,this.data[2]=2*b.i*b.k+2*b.j*b.r,this.data[3]=0,this.data[4]=2*b.i*b.j+2*b.k*b.r,this.data[5]=1-(2*b.i*b.i+2*b.k*b.k),this.data[6]=2*b.j*b.k-2*b.i*b.r,this.data[7]=0,this.data[8]=2*b.i*b.k-2*b.j*b.r,this.data[9]=2*b.j*b.k+2*b.i*b.r,this.data[10]=1-(2*b.i*b.i+2*b.j*b.j),this.data[11]=0,this.data[12]=a.x,this.data[13]=a.y,this.data[14]=a.z,this.data[15]=1,this},b.prototype.add=function(a,b){if(b===null||b===undefined)b=this;for(var c=0;c<=15;c++)b.data[c]=this.data[c]+a.data[c];return b},b.prototype.multiply=function(a,b){if(b===null||b===undefined)b=this;var c=this.data[0]*a.data[0]+this.data[4]*a.data[1]+this.data[8]*a.data[2]+this.data[12]*a.data[3],d=this.data[1]*a.data[0]+this.data[5]*a.data[1]+this.data[9]*a.data[2]+this.data[13]*a.data[3],e=this.data[2]*a.data[0]+this.data[6]*a.data[1]+this.data[10]*a.data[2]+this.data[14]*a.data[3],f=this.data[3]*a.data[0]+this.data[7]*a.data[1]+this.data[11]*a.data[2]+this.data[15]*a.data[3],g=this.data[0]*a.data[4]+this.data[4]*a.data[5]+this.data[8]*a.data[6]+this.data[12]*a.data[7],h=this.data[1]*a.data[4]+this.data[5]*a.data[5]+this.data[9]*a.data[6]+this.data[13]*a.data[7],i=this.data[2]*a.data[4]+this.data[6]*a.data[5]+this.data[10]*a.data[6]+this.data[14]*a.data[7],j=this.data[3]*a.data[4]+this.data[7]*a.data[5]+this.data[11]*a.data[6]+this.data[15]*a.data[7],k=this.data[0]*a.data[8]+this.data[4]*a.data[9]+this.data[8]*a.data[10]+this.data[12]*a.data[11],l=this.data[1]*a.data[8]+this.data[5]*a.data[9]+this.data[9]*a.data[10]+this.data[13]*a.data[11],m=this.data[2]*a.data[8]+this.data[6]*a.data[9]+this.data[10]*a.data[10]+this.data[14]*a.data[11],n=this.data[3]*a.data[8]+this.data[7]*a.data[9]+this.data[11]*a.data[10]+this.data[15]*a.data[11],o=this.data[0]*a.data[12]+this.data[4]*a.data[13]+this.data[8]*a.data[14]+this.data[12]*a.data[15],p=this.data[1]*a.data[12]+this.data[5]*a.data[13]+this.data[9]*a.data[14]+this.data[13]*a.data[15],q=this.data[2]*a.data[12]+this.data[6]*a.data[13]+this.data[10]*a.data[14]+this.data[14]*a.data[15],r=this.data[3]*a.data[12]+this.data[7]*a.data[13]+this.data[11]*a.data[14]+this.data[15]*a.data[15];return b.data[0]=c,b.data[1]=d,b.data[2]=e,b.data[3]=f,b.data[4]=g,b.data[5]=h,b.data[6]=i,b.data[7]=j,b.data[8]=k,b.data[9]=l,b.data[10]=m,b.data[11]=n,b.data[12]=o,b.data[13]=p,b.data[14]=q,b.data[15]=r,b},b.prototype.axisVector=function(b,c){if(c===null||c===undefined)c=new a;return c.set(this.data[b*4],this.data[b*4+1],this.data[b*4+2])},b.prototype.transformVector=function(a,b){if(b===null||b===undefined)b=a;var c=a.x*this.data[0]+a.y*this.data[4]+a.z*this.data[8]+this.data[12],d=a.x*this.data[1]+a.y*this.data[5]+a.z*this.data[9]+this.data[13];return b.z=a.x*this.data[2]+a.y*this.data[6]+a.z*this.data[10]+this.data[14],b.x=c,b.y=d,b},b.prototype.transformInverseVector=function(a,b){if(b===null||b===undefined)b=a;var c=this.data,d=a.x-c[12],e=a.y-c[13],f=a.z-c[14];return b.x=d*c[0]+e*c[1]+f*c[2],b.y=d*c[4]+e*c[5]+f*c[6],b.z=d*c[8]+e*c[9]+f*c[10],b},b.prototype.transformMatrix3D=function(a,b){if(b===null||b===undefined)b=a;var c=this.data,d=this.data,e=c[0]*d[0]+c[4]*d[1]+c[8]*d[2],f=c[0]*d[3]+c[4]*d[4]+c[8]*d[5],g=c[0]*d[6]+c[4]*d[7]+c[8]*d[8],h=c[1]*d[0]+c[5]*d[1]+c[9]*d[2],i=c[1]*d[3]+c[5]*d[4]+c[9]*d[5],j=c[1]*d[6]+c[5]*d[7]+c[9]*d[8],k=c[2]*d[0]+c[6]*d[1]+c[10]*d[2],l=c[2]*d[3]+c[6]*d[4]+c[10]*d[5],m=c[2]*d[6]+c[6]*d[7]+c[10]*d[8];b.data[0]=e*c[0]+f*c[4]+g*c[8],b.data[1]=h*c[0]+i*c[4]+j*c[8],b.data[2]=k*c[0]+l*c[4]+m*c[8],b.data[3]=e*c[1]+f*c[5]+g*c[9],b.data[4]=h*c[1]+i*c[5]+j*c[9],b.data[5]=k*c[1]+l*c[5]+m*c[9],b.data[6]=e*c[2]+f*c[6]+g*c[10],b.data[7]=h*c[2]+i*c[6]+j*c[10],b.data[8]=k*c[2]+l*c[6]+m*c[10]},b}();return d}),define("src/goom-math",["./vector3d","./quaternion","./matrix3d","./matrix4d"],function(a,b,c,d){return Mathematics={},Mathematics.Vector3D=a,Mathematics.Quaternion=b,Mathematics.Matrix3D=c,Mathematics.Matrix4D=d,Mathematics}),define("goom-math",function(){}),define("src/bounding_sphere",["goom-math"],function(a){var b=function(){function b(b,c){if(b===null||b===undefined)b=new a.Vector3D;this.radious=c!==null&&c!==undefined?c:1,this.position=b.clone(),this.__helperVector=new a.Vector3D}return b.createfromSpheres=function(c,d){var e,f,g=new a.Vector3D;d.position.substract(c.position,g);var h=g.squaredMagnitude(),i=d.radious-c.radious;return i*i>=h?c.radious>d.radious?(e=c.position.clone(),f=c.radious):(e=d.position.clone(),f=d.radious):(h=Math.sqrt(h),f=(h+c.radious+d.radious)*.5,e=c.position.clone(),h>0&&e.add(g.scale((f-c.radious)/h))),new b(e,f)},b.prototype.fitSpheres=function(a,b){var c=b.position.x-a.position.x,d=b.position.y-a.position.y,e=b.position.z-a.position.z,f=c*c+d*d+e*e,g=b.radious-a.radious;if(g*g>=f)a.radious>b.radious?(a.position.clone(this.position),this.radious=a.radious):(b.position.clone(this.position),this.radious=b.radious);else{f=Math.sqrt(f),this.radious=(f+a.radious+b.radious)*.5,a.position.clone(this.position);if(f>0){var h=(this.radious-a.radious)/f;this.position.x+=c*h,this.position.y+=d*h,this.position.z+=e*h}}},b.prototype.overlaps=function(b){var c=new a.Vector3D,d=this.position.substract(b.position,c).squaredMagnitude();return d<(this.radious+b.radious)*(this.radious+b.radious)},b.prototype.size=function(){return 1.333333*Math.PI*this.radious*this.radious*this.radious},b.prototype.growth=function(a){var b=a.position.substract(this.position,this.__helperVector),c=b.squaredMagnitude(),d=a.radious-this.radious,e=0;return d*d>=c?this.radious>a.radious?e=this.radious:e=a.radious:(c=Math.sqrt(c),e=(c+this.radious+a.radious)*.5),e*e-this.radious*this.radious},b}();return b}),define("src/primitives",["goom-math"],function(a){var b=Object.prototype.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a},d={},e=function(){function b(b,c){this.body=b;if(c===null||c===undefined)c=new a.Matrix4D;this.offset=c.clone(),this.transformationMatrix=new a.Matrix4D,this.body!==null&&this.body!==undefined?this.calculateInternalData():this.transformationMatrix=this.offset}return b.prototype.calculateInternalData=function(){this.body!==null&&this.body!==undefined&&this.body.transformationMatrix.clone(this.transformationMatrix),this.transformationMatrix.data[12]+=this.offset.data[12],this.transformationMatrix.data[13]+=this.offset.data[13],this.transformationMatrix.data[14]+=this.offset.data[14]},b.prototype.position=function(a){return this.transformationMatrix.axisVector(3,a)},b.prototype.axisVector=function(a,b){return this.transformationMatrix.axisVector(a,b)},d.Primitive=b,b}(),f=function(){function a(b,c,d){this.radious=c,a.__super__.constructor.call(this,b,d)}return c(a,d.Primitive),d.Sphere=a,a}(),g=function(){function a(a,b,c){this.body=a,this.normal=b,this.offset=c!==null&&c!==undefined?c:0}return c(a,d.Primitive),a.prototype.calculateInternalData=function(){},d.Plane=a,a}(),h=function(){function a(b,c,d){a.__super__.constructor.call(this,b,d),this.halfSize=c.clone()}return c(a,d.Primitive),d.Box=a,a}();return d}),define("src/intersection_tests",["goom-math","./primitives"],function(a){var b={};return b.__helperVector=new a.Vector3D,b.boxAndHalfSpace=function(a,c){var d=a.halfSize,e=d.x*Math.abs(c.normal.dotProduct(a.axisVector(0,b.__helperVector)))+d.y*Math.abs(c.normal.dotProduct(a.axisVector(1,b.__helperVector)))+d.z*Math.abs(c.normal.dotProduct(a.axisVector(2,b.__helperVector))),f=c.normal.dotProduct(a.position(b.__helperVector))-e;return f<=c.offset},b}),define("src/bounding_volume_hierarchy_node",["goom-math","./bounding_sphere","./rigid_body"],function(a,b){var c=function(){function a(a,c,d){this.parent=a!==null&&a!==undefined?a:null,this.body=c!==null&&c!==undefined?c:null,this.volume=d!==null&&d!==undefined?d:new b,this.body!==null&&this.body!==undefined&&(this.body.boundingVolumeHierarchyNode=this),this.children=new Array(2)}return a.prototype.isLeaf=function(){return this.body!==null&&this.body!==undefined},a.prototype.isRoot=function(){return this.parent===null||this.parent===undefined},a.prototype.overlaps=function(a){return this.volume.overlaps(a.volume)},a.prototype.potentialContacts=function(a,b){if(b===null||b===undefined)b=1e3;return this.isLeaf()||b===0?0:this.children[0].potentialContactsWith(this.children[1],a,b)},a.prototype.potentialContactsWith=function(a,b,c){if(!this.overlaps(a)||c===0)return 0;if(this.isLeaf()&&a.isLeaf())return b.push([this.body,a.body]),1;var d=0;return a.isLeaf()||!this.isLeaf()&&this.volume.size()>=a.volume.size()?(d=this.children[0].potentialContactsWith(a,b,c),c>d&&(d+=this.children[1].potentialContactsWith(a,b,c-d))):(d=this.potentialContactsWith(a.children[0],b,c),c>d&&(d+=this.potentialContactsWith(a.children[1],b,c-d))),d},a.prototype.calculateBoundingVolume=function(){this.isLeaf||this.volume.fitSpheres(this.children[0].volume,this.children[1].volume)},a.prototype.insert=function(c,d){if(this.isLeaf()){this.children[0]=new a(this,this.body,new b(this.volume.position,this.volume.radious)),this.children[1]=new a(this,c,d),this.body=null,this.calculateBoundingVolume();return}this.children[0].volume.growth(d)<this.children[1].volume.growth(d)?this.children[0].insert(c,d):this.children[1].insert(c,d)},a.prototype.free=function(a){if(a===null||a===undefined)a=!0;if(!this.isRoot()&&a){var b=this.parent.children[0]===this?this.parent.children[1]:this.parent.children[0];this.parent.volume=b.volume,this.parent.body=b.body,this.parent.body!==null&&this.parent.body!==undefined&&(this.parent.body.boundingVolumeHierarchyNode=this.parent),b.children[0]!==null&&b.children[0]!==undefined?(this.parent.children[0]=b.children[0],this.parent.children[0].parent=this.parent):this.parent.children[0]=null,b.children[1]!==null&&b.children[1]!==undefined?(this.parent.children[1]=b.children[1],this.parent.children[1].parent=this.parent):this.parent.children[1]=null}if(this.isLeaf())return;this.children[0].free(!1),this.children[1].free(!1),this.children[0]=null,this.children[1]=null},a.prototype.updateHierarchy=function(){this.body.position.clone(this.volume.position),this.isRoot()||(this.free(),this.parent.reinsert(this.body,this.volume))},a.prototype.reinsert=function(a,b){this.volume.growth(b)<=0||this.isRoot()?this.insert(a,b):this.parent.reinsert(a,b)},a}();return c}),define("src/rigid_body",["goom-math","./primitives","./bounding_volume_hierarchy_node"],function(a,b){var c=function(){function c(b,c,d,e){this.position=b!==null&&b!==undefined?b:new a.Vector3D,this.orientation=c!==null&&c!==undefined?c:new a.Quaternion,this.velocity=d!==null&&d!==undefined?d:new a.Vector3D,this.angular_velocity=e!==null&&e!==undefined?e:new a.Vector3D,this.inverseMass=0,this.acceleration=new a.Vector3D,this.lastFrameAcceleration=new a.Vector3D,this.transformationMatrix=new a.Matrix4D,this.inverseInertiaTensor=new a.Matrix3D,this.inverseInertiaTensorWorld=new a.Matrix3D,this.accumulatedForce=new a.Vector3D,this.accumulatedTorque=new a.Vector3D,this.isAwake=!0,this.canSleep=!0,this.motion=0,this.boundingVolumeHierarchyNode=null,this.primitives=[],this.calculateInternalData(),this.__helperVector=new a.Vector3D}return c.prototype.setInertiaTensor=function(a){a.inverse(this.inverseInertiaTensor)},c.prototype.setInertiaTensorCoefficients=function(b,c,d){var e=new a.Matrix3D;e.setDiagonal(b,c,d),e.inverse(this.inverseInertiaTensor)},c.prototype.calculateInternalData=function(){this.orientation.normalize(),this.transformationMatrix.makeFromPositionAndOrientation(this.position,this.orientation),this.transformationMatrix.transformMatrix3D(this.inverseInertiaTensor,this.inverseInertiaTensorWorld),_ref=this.primitives;for(var a=0,b=_ref.length;a<b;a++)primitive=_ref[a],primitive.calculateInternalData();this.boundingVolumeHierarchyNode!==null&&this.boundingVolumeHierarchyNode.updateHierarchy()},c.prototype.wakeUp=function(){this.isAwake=!0,this.motion=2*c.SLEEP_EPSILON},c.prototype.sleep=function(){this.isAwake=!1,this.velocity.zero(),this.angular_velocity.zero()},c.prototype.applyForce=function(a){this.accumulatedForce.add(a),this.wakeUp()},c.prototype.applyForceAtPoint=function(a,b){b.substract(this.position,this.__helperVector),this.accumulatedForce.add(a),this.accumulatedTorque.add(this.__helperVector.crossProduct(a)),this.wakeUp()},c.prototype.applyForceAtBodyPoint=function(a,b){this.applyForceAtPoint(a,this.transformationMatrix.transformVector(b,this.__helperVector))},c.prototype.applyTorque=function(a){this.accumulatedTorque.add(a),this.wakeUp()},c.prototype.clear=function(){this.accumulatedForce.zero(),this.accumulatedTorque.zero()},c.prototype.hasFiniteMass=function(){return this.inverseMass>=0},c.prototype.getMass=function(){return this.inverseMass===0?Number.MAX_VALUE:1/this.inverseMass},c.prototype.setMass=function(a){a===0&&(this.inverseMass=Number.MAX_VALUE),this.inverseMass=1/a},c.prototype.addPrimitives=function(c){if(!(c instanceof Array)){switch(c.type.toLowerCase()){case"sphere":this.primitives.push(new b.Sphere(this,c.radious,c.offset!==null&&c.offset!==undefined?(new a.Matrix4D).set(c.offset):null));break;case"box":this.primitives.push(new b.Box(this,new a.Vector3D(c.halfSize.x,c.halfSize.y,c.halfSize.z),c.offset!==null&&c.offset!==undefined?(new a.Matrix4D).set(c.offset):null));break;default:throw"Unkwnown primitive type"}return}var d,e,f;for(e=0,f=c.length;e<f;e++){d=c[e];switch(d.type.toLowerCase()){case"sphere":this.primitives.push(new b.Sphere(this,d.radious,d.offset!==null&&c.offset!==undefined?(new a.Matrix4D).set(d.offset):null));break;case"box":this.primitives.push(new b.Box(this,new a.Vector3D(d.halfSize.x,d.halfSize.y,d.halfSize.z),d.offset!==null&&c.offset!==undefined?(new a.Matrix4D).set(d.offset):null));break;default:throw"Unkwnown primitive type"}}},c.prototype.integrate=function(a){if(!this.isAwake)return;this.acceleration.clone(this.lastFrameAcceleration),this.lastFrameAcceleration.add(this.accumulatedForce.scale(this.inverseMass,this.__helperVector)),this.inverseInertiaTensorWorld.transformVector(this.accumulatedTorque,this.__helperVector),this.angular_velocity.add(this.__helperVector.scale(a)),this.velocity.add(this.lastFrameAcceleration.scale(a,this.__helperVector)),this.velocity.scale(Math.pow(c.LINEAR_DAMPING,a)),this.angular_velocity.scale(Math.pow(c.ANGULAR_DAMPING,a)),this.clear();if(this.canSleep){var b=this.velocity.squaredMagnitude()+this.angular_velocity.squaredMagnitude(),d=Math.pow(.5,a);this.motion=d*this.motion+(1-d)*b;if(this.motion<c.SLEEP_EPSILON){this.sleep();return}if(this.motion>5*c.SLEEP_EPSILON)this.motion=5*c.SLEEP_EPSILON;else if(b<c.SLEEP_EPSILON)return}this.position.add(this.velocity.scale(a,this.__helperVector)),this.orientation.addVector(this.angular_velocity.scale(a,this.__helperVector)),this.calculateInternalData()},c.SLEEP_EPSILON=.2,c.LINEAR_DAMPING=.9999,c.ANGULAR_DAMPING=.9999,c}();return c}),define("src/contact",["goom-math","./rigid_body"],function(a){var b=function(){function b(b,c,d){this.penetration=d!==null&&d!==undefined?d:0,this.point=b===null||b===undefined?new a.Vector3D:b.clone(),this.normal=c===null||b===undefined?new a.Vector3D:c.clone(),this.bodies=new Array(2),this.relativeContactPositions=new Array(2),this.relativeContactPositions[0]=new a.Vector3D,this.relativeContactPositions[1]=new a.Vector3D,this.desiredDeltaVelocity=0,this.velocity=new a.Vector3D,this.__helperVector=new a.Vector3D,this.__contactTangent=new Array(2),this.__contactTangent[0]=new a.Vector3D,this.__contactTangent[1]=new a.Vector3D,this.__angularInertia=new Array(2),this.__angularInertia[0]=0,this.__angularInertia[1]=0,this.__linearInertia=new Array(2),this.__linearInertia[0]=0,this.__linearInertia[1]=0,this.__impulse=new a.Vector3D,this.toWorld=new a.Matrix3D}return b.prototype.setContactData=function(a,b,c,d){this.bodies[0]=a,this.bodies[1]=b,this.restitution=c,this.friction=d},b.prototype.__swapBodies=function(){this.normal.scale(-1);var a=this.bodies[0];this.bodies[0]=this.bodies[1],this.bodies[1]=a},b.prototype.matchAwakeState=function(){if(this.bodies[1]===null||this.bodies[1]===undefined)return;this.bodies[0].isAwake^this.bodies[1].isAwake&&(this.bodies[0].isAwake?this.bodies[0].wakeUp():this.bodies[1].wakeUp())},b.prototype.calculateDesiredDeltaVelocity=function(a){var c=this.normal.scale(a,this.__helperVector),d=0;this.bodies[0].isAwake&&(d=this.bodies[0].lastFrameAcceleration.dotProduct(c)),this.bodies[1]!==null&&this.bodies[1]!==undefined&&this.bodies[1].isAwake&&(d-=this.bodies[1].lastFrameAcceleration.dotProduct(c));var e=this.restitution;Math.abs(this.velocity.x)<b.MIN_VELOCITY&&(e=0),this.desiredDeltaVelocity=-this.velocity.x-e*(this.velocity.x-d)},b.prototype.calculateInternalData=function(a){var b;(this.bodies[0]===null||this.bodies[0]===undefined)&&this._swapBodies(),Math.abs(this.normal.x)>Math.abs(this.normal.y)?(b=1/Math.sqrt(this.normal.z*this.normal.z+this.normal.x*this.normal.x),this.__contactTangent[0].x=this.normal.z*b,this.__contactTangent[0].y=0,this.__contactTangent[0].z=-this.normal.x*b,this.__contactTangent[1].x=this.normal.y*this.__contactTangent[0].x,this.__contactTangent[1].y=this.normal.z*this.__contactTangent[0].x-this.normal.x*this.__contactTangent[0].z,this.__contactTangent[1].z=-this.normal.y*this.__contactTangent[0].x):(b=1/Math.sqrt(this.normal.z*this.normal.z+this.normal.y*this.normal.y),this.__contactTangent[0].x=0,this.__contactTangent[0].y=-this.normal.z*b,this.__contactTangent[0].z=this.normal.y*b,this.__contactTangent[1].x=this.normal.y*this.__contactTangent[0].z-this.normal.z*this.__contactTangent[0].y,this.__contactTangent[1].y=-this.normal.x*this.__contactTangent[0].z,this.__contactTangent[1].z=this.normal.x*this.__contactTangent[0].y),this.toWorld.makeFromVectors(this.normal,this.__contactTangent[0],this.__contactTangent[1]),this.point.substract(this.bodies[0].position,this.relativeContactPositions[0]),this.bodies[1]!==null&&this.bodies[1]!==undefined&&this.point.substract(this.bodies[1].position,this.relativeContactPositions[1]),this.bodies[0].angular_velocity.crossProduct(this.relativeContactPositions[0],this.velocity),this.velocity.add(this.bodies[0].velocity);var c=this.bodies[0].lastFrameAcceleration.scale(a,this.__helperVector);c.x=0,this.velocity.add(c);if(this.bodies[1]!==null&&this.bodies[1]!==undefined){var d=this.bodies[1].angular_velocity.crossProduct(this.relativeContactPositions[1],this.__helperVector);d.add(this.bodies[1].velocity),this.velocity.substract(d),c=this.bodies[1].lastFrameAcceleration.scale(a,this.__helperVector),c.x=0,this.velocity.substract(c)}this.toWorld.transformTransposeVector(this.velocity),this.calculateDesiredDeltaVelocity(a)},b.prototype.resolvePosition=function(a,c,d){var e=0,f=0,g=this.relativeContactPositions[0].crossProduct(this.normal,this.__helperVector);this.bodies[0].inverseInertiaTensorWorld.transformVector(g),g.crossProduct(this.relativeContactPositions[0]),this.__angularInertia[0]=g.dotProduct(this.normal),this.__linearInertia[0]=this.bodies[0].inverseMass,e+=this.__angularInertia[0]+this.__linearInertia[0],this.bodies[1]!==null&&this.bodies[1]!==undefined&&(g=this.relativeContactPositions[1].crossProduct(this.normal,this.__helperVector),this.bodies[1].inverseInertiaTensorWorld.transformVector(g),g.crossProduct(this.relativeContactPositions[1]),this.__angularInertia[1]=g.dotProduct(this.normal),this.__linearInertia[1]=this.bodies[1].inverseMass,e+=this.__angularInertia[1]+this.__linearInertia[1]);var h=d*(this.__angularInertia[0]/e),i=d*(this.__linearInertia[0]/e),j=this.normal.scale(-this.relativeContactPositions[0].dotProduct(this.normal),this.__helperVector).add(this.relativeContactPositions[0]),k=b.ANGULAR_LIMIT*j.magnitude(),l;h<-k?(f=h+i,h=-k,i=f-h):h>k&&(f=h+i,h=k,i=f-h),h===0?c[0].zero():(l=this.normal.crossProduct(this.relativeContactPositions[0],this.__helperVector),this.bodies[0].inverseInertiaTensorWorld.transformVector(l).scale(h/this.__angularInertia[0]).clone(c[0])),this.normal.scale(i,a[0]),this.bodies[0].position.add(a[0]),this.bodies[0].orientation.addVector(c[0]),this.bodies[0].isAwake||this.bodies[0].calculateInternalData(),this.bodies[1]!==null&&this.bodies[1]!==undefined&&(h=-d*(this.__angularInertia[1]/e),i=-d*(this.__linearInertia[1]/e),j=this.normal.scale(-this.relativeContactPositions[1].dotProduct(this.normal),this.__helperVector).add(this.relativeContactPositions[1]),k=b.ANGULAR_LIMIT*j.magnitude(),h<-k?(f=h+i,h=-k,i=f-h):h>k&&(f=h+i,h=k,i=f-h),h===0?c[1].zero():(l=this.normal.crossProduct(this.relativeContactPositions[1],this.__helperVector),this.bodies[1].inverseInertiaTensorWorld.transformVector(l).scale(h/this.__angularInertia[1]).clone(c[1])),this.normal.scale(i,a[1]),this.bodies[1].position.add(a[1]),this.bodies[1].orientation.addVector(c[1]),this.bodies[1].isAwake||this.bodies[1].calculateInternalData())},b.prototype.resolveVelocity=function(a,b){if(this.friction===0){delta_velocity_world=this.relativeContactPositions[0].crossProduct(this.normal,this.__helperVector),this.bodies[0].inverseInertiaTensorWorld.transformVector(delta_velocity_world),delta_velocity_world.crossProduct(this.relativeContactPositions[0]);var c=delta_velocity_world.dotProduct(this.normal);c+=this.bodies[0].inverseMass,this.bodies[1]!==null&&this.bodies!==undefined&&(delta_velocity_world=this.relativeContactPositions[1].crossProduct(this.normal,this.__helperVector),this.bodies[1].inverseInertiaTensorWorld.transformVector(delta_velocity_world),delta_velocity_world.crossProduct(this.relativeContactPositions[1]),c+=delta_velocity_world.dotProduct(this.normal),c+=this.bodies[1].inverseMass),this.__impulse.set(this.desiredDeltaVelocity/c,0,0)}else this.__impulse.zero();this.toWorld.transformVector(this.__impulse);var d=this.relativeContactPositions[0].crossProduct(this.__impulse,this.__helperVector);this.bodies[0].inverseInertiaTensorWorld.transformVector(d,b[0]),console.log(d,b[0]),this.__impulse.scale(this.bodies[0].inverseMass,a[0]),this.bodies[0].angular_velocity.add(b[0]),this.bodies[0].velocity.add(a[0]),this.bodies[1]!==null&&this.bodies[1]!==undefined&&(this.__impulse.scale(-1),this.relativeContactPositions[1].crossProduct(this.__impulse,d),this.bodies[1].inverseInertiaTensorWorld.transformVector(d,b[1]),this.__impulse.scale(this.bodies[1].inverseMass,a[1]),this.bodies[1].angular_velocity.add(b[1]),this.bodies[1].velocity.add(a[1]))},b.MIN_VELOCITY=.25,b.ANGULAR_LIMIT=.2,b}();return b}),define("src/collision_detector",["goom-math","./contact","./intersection_tests","./primitives","./rigid_body"],function(a,b,c,d){var e=function(){function e(c){this.MAX_CONTACTS=c===null||c===undefined?30:c,this.contactCache=new Array(this.MAX_CONTACTS),this.contactCacheTop=0;for(var d=this.MAX_CONTACTS;d>=0;d--)this.contactCache[d]=new b;this.__helperVector=new a.Vector3D,this.__helperVector2=new a.Vector3D,this.__helperVector3=new a.Vector3D,this.__helperVector4=new a.Vector3D,this.__helperVector5=new a.Vector3D,this.__helperVector6=new a.Vector3D,this.__helperVector7=new a.Vector3D,this.__helperMatrix=new a.Matrix3D,this.__axisTestData=new Array(3)}e.multipliers=[[1,1,1],[-1,1,1],[1,-1,1],[-1,-1,1],[1,1,-1],[-1,1,-1],[1,-1,-1],[-1,-1,-1]],e.prototype.__getFreeContact=function(){return this.contactCacheTop>=this.MAX_CONTACTS?new b:(this.contactCacheTop++,this.contactCache[this.contactCacheTop-1])},e.prototype.clearCache=function(){this.contactCacheTop=0},e.prototype.sphereAndSphere=function(a,b,c,d){var e=a.position(this.__helperVector),f=b.position(this.__helperVector2),g=e.substract(f,this.__helperVector2),h=g.magnitude();if(h<=0||h>=a.radious+b.radious)return!1;var i=this.__getFreeContact();return g.scale(1/h,i.normal),e.substract(g.scale(.5),i.point),i.penetration=a.radious+b.radious-h,i.setContactData(a.body,b.body,c.restitution,c.friction),d.push(i),!0},e.prototype.sphereAndHalfSpace=function(a,b,c,d){var e=a.position(this.__helperVector),f=b.normal.dotProduct(e)-a.radious-b.offset;if(f>=0)return!1;var g=this.__getFreeContact();return e.substract(b.normal.scale(f+a.radious,g.point),g.point),b.normal.clone(g.normal),g.penetration=-f,g.setContactData(a.body,null,c.restitution,c.friction),d.push(g),!0},e.prototype.boxAndHalfSpace=function(a,b,d,f){if(!c.boxAndHalfSpace(a,b))return!1;contacts_found=!1;for(i=0;i<=7;i++){var g=this.__helperVector.set(e.multipliers[i][0],e.multipliers[i][1],e.multipliers[i][2]);g.componentProduct(a.halfSize),a.transformationMatrix.transformVector(g);var h=g.dotProduct(b.normal);if(h<=b.offset){var j=this.__getFreeContact();b.normal.scale(-(h-b.offset),j.point),j.point.add(g),b.normal.clone(j.normal),j.penetration=b.offset-h,j.setContactData(a.body,null,d.restitution,d.friction),f.push(j),contacts_found=!0}}return contacts_found},e.prototype.boxAndSphere=function(a,b,c,d){var e=b.position(this.__helperVector),f=a.transformationMatrix.transformInverseVector(e,this.__helperMatrix);if(Math.abs(f.x)-b.radious>a.halfSize.x||Math.abs(f.y)-b.radious>a.halfSize.y||Math.abs(f.z)-b.radious>a.halfSize.z)return!1;var g=f.x;g>a.halfSize.x&&(g=a.halfSize.x),g<-a.halfSize.x&&(g=-a.halfSize.x),this.__helperVector2.x=g,g=f.y,g>a.halfSize.y&&(g=a.halfSize.y),g<-a.halfSize.y&&(g=-a.halfSize.y),this.__helperVector2.y=g,g=f.z,g>a.halfSize.z&&(g=a.halfSize.z),g<-a.halfSize.z&&(g=-a.halfSize.z),this.__helperVector2.z=g,g=this.__helperVector2.substract(f,this.__helperVector).squaredMagnitude();if(g>b.radious*b.radious)return!1;e=b.position(this.__helperVector);var h=this.__getFreeContact();return a.transformationMatrix.transformVector(this.__helperVector2),this.__helperVector2.clone(h.point),this.__helperVector2.substract(e).normalize().clone(h.normal),h.penetration=b.radious-Math.sqrt(g),h.setContactData(a.body,b.body,c.restitution,c.friction),d.push(h),!0},e.prototype.__testAxis=function(a,b,c,d,e,f,g){if(c.squaredMagnitude()<1e-4)return this.__axisTestData[0]=!0,this.__axisTestData[1]=f,this.__axisTestData[2]=g,this.__axisTestData;c.normalize();var h=a.halfSize.x*Math.abs(c.dotProduct(a.axisVector(0,this.__helperVector)))+a.halfSize.y*Math.abs(c.dotProduct(a.axisVector(1,this.__helperVector)))+a.halfSize.z*Math.abs(c.dotProduct(a.axisVector(2,this.__helperVector))),i=b.halfSize.x*Math.abs(c.dotProduct(b.axisVector(0,this.__helperVector)))+b.halfSize.y*Math.abs(c.dotProduct(b.axisVector(1,this.__helperVector)))+b.halfSize.z*Math.abs(c.dotProduct(b.axisVector(2,this.__helperVector))),j=h+i-Math.abs(d.dotProduct(c));return j<0?(this.__axisTestData[0]=!1,this.__axisTestData[1]=f,this.__axisTestData[2]=g,this.__axisTestData):(j<f&&(f=j,g=e),this.__axisTestData[0]=!0,this.__axisTestData[1]=f,this.__axisTestData[2]=g,this.__axisTestData)};var f="x",g="y",h="z",j=function(){switch(index){case 0:return f;case 1:return g;case 2:return h}};return e.prototype.boxAndBox=function(a,b,c,d){var e=b.position(this.__helperVector2).substract(a.position(this.__helperVector)),f,g,h;f=g=Number.MAX_VALUE;var i=!1;h=this.__testAxis(a,b,a.axisVector(0,this.__helperVector3),e,0,f,g),i=h[0],f=h[1],g=h[2];if(!i)return!1;h=this.__testAxis(a,b,a.axisVector(1,this.__helperVector3),e,1,f,g),i=h[0],f=h[1],g=h[2];if(!i)return!1;h=this.__testAxis(a,b,a.axisVector(2,this.__helperVector3),e,2,f,g),i=h[0],f=h[1],g=h[2];if(!i)return!1;h=this.__testAxis(a,b,b.axisVector(0,this.__helperVector3),e,3,f,g),i=h[0],f=h[1],g=h[2];if(!i)return!1;h=this.__testAxis(a,b,b.axisVector(1,this.__helperVector3),e,4,f,g),i=h[0],f=h[1],g=h[2];if(!i)return!1;h=this.__testAxis(a,b,b.axisVector(2,this.__helperVector3),e,5,f,g),i=h[0],f=h[1],g=h[2];if(!i)return!1;var k=g;h=this.__testAxis(a,b,b.axisVector(0,this.__helperVector3).crossProduct(a.axisVector(0,this.__helperVector)),e,6,f,g),i=h[0],f=h[1],g=h[2];if(!i)return!1;h=this.__testAxis(a,b,b.axisVector(1,this.__helperVector3).crossProduct(a.axisVector(0,this.__helperVector)),e,7,f,g),i=h[0],f=h[1],g=h[2];if(!i)return!1;h=this.__testAxis(a,b,b.axisVector(2,this.__helperVector3).crossProduct(a.axisVector(0,this.__helperVector)),e,8,f,g),i=h[0],f=h[1],g=h[2];if(!i)return!1;h=this.__testAxis(a,b,b.axisVector(0,this.__helperVector3).crossProduct(a.axisVector(1,this.__helperVector)),e,9,f,g),i=h[0],f=h[1],g=h[2];if(!i)return!1;h=this.__testAxis(a,b,b.axisVector(1,this.__helperVector3).crossProduct(a.axisVector(1,this.__helperVector)),e,10,f,g),i=h[0],f=h[1],g=h[2];if(!i)return!1;h=this.__testAxis(a,b,b.axisVector(2,this.__helperVector3).crossProduct(a.axisVector(1,this.__helperVector)),e,11,f,g),i=h[0],f=h[1],g=h[2];if(!i)return!1;h=this.__testAxis(a,b,b.axisVector(0,this.__helperVector3).crossProduct(a.axisVector(2,this.__helperVector)),e,12,f,g),i=h[0],f=h[1],g=h[2];if(!i)return!1;h=this.__testAxis(a,b,b.axisVector(1,this.__helperVector3).crossProduct(a.axisVector(2,this.__helperVector)),e,13,f,g),i=h[0],f=h[1],g=h[2];if(!i)return!1;h=this.__testAxis(a,b,b.axisVector(2,this.__helperVector3).crossProduct(a.axisVector(2,this.__helperVector)),e,14,f,g),i=h[0],f=h[1],g=h[2];if(!i)return!1;var l;if(g<3)return l=this.__getFreeContact(),a.axisVector(g,l.normal),l.normal.dotProduct(e)>0&&l.normal.scale(-1),b.halfSize.clone(l.point),b.axisVector(0,this.__helperVector3).dotProduct(l.normal)<0&&(l.point.x=-l.point.x),b.axisVector(1,this.__helperVector3).dotProduct(l.normal)<0&&(l.point.y=-l.point.y),b.axisVector(2,this.__helperVector3).dotProduct(l.normal)<0&&(l.point.z=-l.point.z),b.transformationMatrix.transformVector(l.point),l.penetration=f,l.setContactData(a.body,b.body,c.restitution,c.friction),d.push(l),!0;if(g<6)return g-=3,e.scale(-1),l=this.__getFreeContact(),b.axisVector(g,l.normal),l.normal.dotProduct(e)>0&&l.normal.scale(-1),a.halfSize.clone(l.point),a.axisVector(0,this.__helperVector3).dotProduct(l.normal)<0&&(l.point.x=-l.point.x),a.axisVector(1,this.__helperVector3).dotProduct(l.normal)<0&&(l.point.y=-l.point.y),a.axisVector(2,this.__helperVector3).dotProduct(l.normal)<0&&(l.point.z=-l.point.z),a.transformationMatrix.transformVector(l.point),l.penetration=f,l.setContactData(b.body,a.body,c.restitution,c.friction),d.push(l),!0;g-=6;var m=g%3,n=(g-m)/3,o=a.axisVector(n,this.__helperVector),p=b.axisVector(m,this.__helperVector3),q=p.crossProduct(o,this.__helperVector4).normalize();q.dotProduct(e)>0&&q.scale(-1);var r=a.halfSize.clone(this.__helperVector5),s=b.halfSize.clone(this.__helperVector6);0===n?r.x=0:a.axisVector(0,this.__helperVector7).dotProduct(q)>0&&(r.x=-r.x),0===m?s.x=0:b.axisVector(0,this.__helperVector7).dotProduct(q)<0&&(s.x=-s.x),1===n?r.y=0:a.axisVector(1,this.__helperVector7).dotProduct(q)>0&&(r.y=-r.y),1===m?s.y=0:b.axisVector(1,this.__helperVector7).dotProduct(q)<0&&(s.y=-s.y),2===n?r.z=0:a.axisVector(2,this.__helperVector7).dotProduct(q)>0&&(r.z=-r.z),2===m?s.z=0:b.axisVector(2,this.__helperVector7).dotProduct(q)<0&&(s.z=-s.z),a.transformationMatrix.transformVector(r),b.transformationMatrix.transformVector(s);var t=k>2,u=o.squaredMagnitude(),v=p.squaredMagnitude(),w=p.dotProduct(o),x=r.substract(s,this.__helperVector7),y=o.dotProduct(x),z=p.dotProduct(x),A=u*v-w*w,B;if(Math.abs(A)<1e-4)B=t?r:s;else{var C=(w*z-v*y)/A,D=(u*z-w*y)/A,E=j(n),F=j(m);C>a.halfSize[E]||C<-a.halfSize[E]||D>b.halfSize[F]||D<-b.halfSize[F]?B=t?r:s:(r.add(o.scale(C)),s.add(p.scale(D)),B=r.scale(.5).add(s.scale(.5)))}return l=this.__getFreeContact(),B.clone(l.point),q.clone(l.normal),l.penetration=f,l.setContactData(a.body,b.body,c.restitution,c.friction),d.push(l),!0},e.prototype.checkForContacts=function(a,b,c,e){var f,g,h,i,j,k,l,m=!1,n=a.primitives;for(h=0,j=n.length;h<j;h++){f=n[h],l=b.primitives;for(i=0,k=l.length;i<k;i++){g=l[i];if(f instanceof d.Plane){g instanceof d.Box?m=m||this.boxAndHalfSpace(g,f,c,e):g instanceof d.Sphere&&(m=m||this.sphereAndHalfSpace(g,f,c,e));continue}if(f instanceof d.Box){g instanceof d.Plane?m=m||this.boxAndHalfSpace(f,g,c,e):g instanceof d.Sphere?m=m||this.boxAndSphere(f,g,c,e):g instanceof d.Box&&(m=m||this.boxAndBox(f,g,c,e));continue}if(f instanceof d.Sphere){g instanceof d.Plane?m=m||this.sphereAndHalfSpace(f,g,c,e):g instanceof d.Box?m=m||this.boxAndSphere(g,f,c,e):g instanceof d.Sphere&&(m=m||this.sphereAndSphere(f,g,c,e));continue}}}return m},e.prototype.checkForContactsWithPlane=function(a,b,c,e){var f,g,h,i,j;g=!1,j=a.primitives;for(h=0,i=j.length;h<i;h++){f=j[h];if(f instanceof d.Box){g=g||this.boxAndHalfSpace(f,b,c,e);continue}if(f instanceof d.Sphere){g=g||this.sphereAndHalfSpace(f,primitive_two,c,e);continue}}return g},e}();return e}),define("src/force_generator",["./rigid_body"],function(a){var b=function(){function a(){}return a.prototype.updateForce=function(a,b){},a}();return b}),define("src/body_force_registry",["goom-math","./force_generator","./rigid_body"],function(a){var b=function(){function a(){this.registrations=[]}return a.prototype.add=function(a,b){this.registrations.push({body:a,forceGenerator:b})},a.prototype.remove=function(a,b){var c,d,e;for(c=0,e=this.registrations.length;c<e;c++){d=this.registrations[c];if(d.body===a&&d.forceGenerator===b){this.registrations.splice(c,1);return}}},a.prototype.clear=function(){var a,b,c;for(a=0,c=this.registrations.length;a<c;a++)this.registrations.pop()},a.prototype.updateForces=function(a){var b,c,d,e;e=this.registrations;for(c=0,d=e.length;c<d;c++)b=e[c],b.forceGenerator.updateForce(b.body,a)},a}();return b}),define("src/gravity",["goom-math","./force_generator"],function(a,b){var c=Object.prototype.hasOwnProperty,d=function(a,b){function e(){this.constructor=a}for(var d in b)c.call(b,d)&&(a[d]=b[d]);return e.prototype=b.prototype,a.prototype=new e,a.__super__=b.prototype,a},e=function(){function c(a){this.gravity=a}return d(c,b),__vector=new a.Vector3D,c.prototype.updateForce=function(a,b){if(!a.hasFiniteMass())return;a.applyForce(this.gravity.scale(a.getMass(),__vector))},c}();return e}),define("src/goom-physics",["./body_force_registry","./bounding_sphere","./bounding_volume_hierarchy_node","./collision_detector","./contact","./force_generator","./gravity","./intersection_tests","./primitives","./rigid_body"],function(a,b,c,d,e,f,g,h,i,j){return Physics={},Physics.BodyForceRegistry=a,Physics.BoundingSphere=b,Physics.BoundingVolumeHierarchyNode=c,Physics.CollisionDetector=d,Physics.Contact=e,Physics.ForceGenerator=f,Physics.Gravity=g,Physics.IntersectionTests=h,Physics.Primitives=i,Physics.RigidBody=j,Physics})